# 5hon.com（仮）設計書 v0.2

最終目的：**公開Googleドキュメント共有リンク**から、**Apple Books向け縦書きEPUB（EPUB3）**を生成できる無料Webアプリ（登録なし）。

ビジネス目的：日本語SEO流入（例：縦書きEPUB／EPUB作成／スマホ縦書き）を獲得し、右カラムの**Spotify埋め込み（レクタングル広告枠）**でKazeX Recordsの宣伝・再生誘導を最大化。将来的にサイトM&A可能な状態（運用・数値・法務・技術負債を整備）にする。

ライセンス：MIT（GitHub Public）。

---

## 1. 成功指標（KPI）

### SEO

* 自然検索流入（主要KW：縦書き EPUB／EPUB 作成／スマホ 縦書き／Googleドキュメント EPUB／縦書き ルビ）
* 主要KW順位・CTR・インデックス数

### プロダクト

* 生成成功率（成功 / 総リクエスト）
* 1セッションあたり生成回数
* エラー率（非公開判定、取得失敗、変換失敗、サイズ超過）

### 宣伝（Spotify）

* 埋め込み表示回数
* Spotify遷移クリック率（埋め込み→Spotify）
* KazeX側の外部指標：フォロー／再生増（参考指標）

### M&A視野

* 月間PV/UU、収益（将来広告や寄付を入れる場合）
* 運用コスト（インフラ費、障害頻度、対応時間）
* 引き継ぎ容易性（ドキュメント、テスト、依存関係、ビルド手順）

---

## 2. スコープ

### MVPでやる

* 公開（リンク閲覧可）のGoogleドキュメントURLを受け取り、本文を取得して**縦書きEPUB3**生成
* ルビ記法：`｜漢字《かんじ》`
* 縦中横：チェックボックスで**数字／英字**を個別ON/OFF
* 見出しから目次生成（見出し1/2）
* プレビュー（簡易）：縦書きCSS適用HTMLを表示
* **Apple Booksのみ保証**（他リーダーはベストエフォート）
* スマホ対応UI
* 右カラム：使い方（アコーディオン）＋Spotify埋め込み枠（レクタングル）
* GitHub Public + Cloudflare Pages（自動デプロイ） + 将来5hon.com割当

### MVPではやらない（非対象）

* 非公開ドキュメント（OAuthログイン）
* 画像/表/脚注/コメント/複雑レイアウトの完全再現
* Kindle（mobi/azw/kpf）生成
* Google Play Books向け最適化（将来）

---

## 3. 想定ユーザーとユースケース（ターゲット再定義）

### 主ターゲット：iPhoneで「配れるデジタルZINE」を作りたい人（日本語圏）

* Googleドキュメントで文章を書いている個人クリエイター
* 同人・個人出版・小部数配布を想定している人
* AirDropや共有シートでそのまま配りたい人
* 「EPUBの仕様」よりも「読めて、渡せて、気持ちいい体験」を重視する人

**満たしたい価値**

* 難しい知識なしで縦書きZINEが一瞬でできる
* Apple Booksでそのまま読める
* 表紙があることで“完成物”として配れる

### 副次ターゲット：EPUBセルフパブリッシング層（KDP等）

* 標準的なEPUB3として扱えることを重視する人
* 表紙・目次・メタデータが整ったファイルを求める人
* 将来のKindle/Google Play Books展開を視野に入れる人

**方針**

* UIや言葉遣いはZINE層に寄せる
* 実装の品質はセルパブ層にも耐える“王道EPUB”を維持

### ユーザーストーリー

* 公開共有リンクを貼る → 表紙をアップロード → オプションを選ぶ → **iPhoneで読める縦書きZINE**をDL → Apple Booksで開き、AirDropで共有
* 非公開リンクを貼る → 「公開共有にしてね」エラーで戻る（迷子にしない）

---

## 4. 画面設計（2カラム＋レスポンシブ）

### PC（2カラム）

#### 左カラム（メイン：大きめ）

* サービス名／短い注意書き

  * 対応：Apple Books（EPUB3／縦書き）
  * 公開リンクのみ（非公開は不可）
* URL入力ボックス（1行）
* オプション

  * ☑ 縦中横：数字
  * ☑ 縦中横：英字
* 生成ボタン
* 生成完了後：DLボタン（EPUB）
* プレビュー領域（生成前は説明、生成後はiframeで縦書きプレビュー）

#### 右カラム（サブ：レクタングルが入る幅）

* 使い方（▼で開くアコーディオン）
* Spotify埋め込み枠（レクタングル想定）

### スマホ（縦積み）

上から順に縦並び：

1. URL入力＋オプション＋生成/DL
2. プレビュー（折りたたみ可能）
3. 使い方（アコーディオン）
4. Spotify埋め込み（ページ下部）

### UIポリシー

* 生成まで最短2操作（URL貼る→生成）
* エラーは「原因＋直し方」を短く提示

---

## 5. 入力仕様

### 入力

* Google DocsのURLのみ：`docs.google.com/document/d/<DOC_ID>/...`
* 許可例：`https://docs.google.com/document/d/<DOC_ID>/edit?usp=sharing`

### 公開判定（サーバー側）

* export取得を試行し、以下を組み合わせて判定

  * HTTPステータス（401/403など）
  * ログイン誘導HTMLの検出
  * 本文構造が抽出できるか

### 失敗時メッセージ（例）

* 「このドキュメントは非公開の可能性があります。“リンクを知っている全員が閲覧可”にしてから再試行してください。」

---

## 6. 変換パイプライン（中核）

### ステップ

1. URL解析 → docId抽出
2. 取得（推奨：HTML export）

   * `.../export?format=html`
3. 正規化

   * 不要タグ除去（style/script等）
   * 段落/見出し抽出（p, h1, h2）
4. ルビ変換

   * パターン：`｜([^《]+)《([^》]+)》`
   * 変換：`<ruby>本文<rt>ルビ</rt></ruby>`
   * 崩れそうなケースは安全側（ルビを落として本文だけ残す）
5. 縦中横（オプション）

   * 数字ON：`[0-9]{2,4}` を基本対象
   * 英字ON：`[A-Za-z]{2,4}` を基本対象
   * 変換：`<span class="tcy">…</span>`
   * 注意：`ruby`/`rt` 内は対象外（誤爆回避）
6. EPUB3生成（zip）

   * `content.opf`（metadata/manifest/spine）
   * `nav.xhtml`（目次）
   * 本文XHTML（章ごと or 1ファイル）
   * CSS（縦書き、縦中横、必要最低限の整形）
   * `mimetype` + `META-INF/container.xml`

---

## 7. EPUB仕様（Apple Books最適）

* EPUB：EPUB 3
* 言語：ja

### 表紙（追加要件）

#### 入力

* ユーザーが画像をアップロードして表紙にできる（推奨：JPEG/PNG）
* 未アップロードの場合は「文字だけのシンプル表紙」を自動生成

#### EPUBで使う画像形式

* EPUBは一般に **JPEG / PNG / GIF / SVG** を扱える（ただしリーダーによって得意不得意があるため、MVPはJPEG/PNGを推奨）
* Apple Books向けにはJPEG/PNGの互換性が高い

#### 生成仕様

* アップロード画像がある場合：

  * `cover.jpg` または `cover.png` としてEPUB内に同梱
  * `content.opf` の `metadata` と `manifest` に表紙を登録
  * 表紙XHTML（例：`cover.xhtml`）をspine先頭に配置
* 画像がない場合：

  * `cover.xhtml` を自動生成（タイトルのみ・余白多め・縦書き/横書きは後で選定）
  * 背景は白、装飾は最小

### CSS方針（例）

* `writing-mode: vertical-rl;`
* 縦中横：`text-combine-upright`（Apple Books中心で検証）

### 章分割

* MVP：1ファイルでも可
* 長文で重い場合：見出し1ごとに分割

### 目次生成

* 見出し1 → 目次レベル1
* 見出し2 → 目次レベル2
* 目次が空でも生成は成功扱い（navは作成）

### メタデータ

* title：Googleドキュメントのタイトル
* creator：MVPでは空（将来入力追加）
* identifier：docId + 生成時刻ハッシュ

### 最終ページ（バックマター）※追加要件

* 本文の末尾に **最終ページ（backmatter）** を自動付与
* 内容：小さく、控えめに **5hon.com** へのリンクのみ
* 表示位置：ページ下部（余白多め）
* 表記例：`https://5hon.com`
* 装飾は最小（小さめのフォント、下寄せ、中央または右寄せ）
* ユーザーが将来ON/OFFできるオプションを検討（MVPでは固定ONでも可）

---

## 8. プレビュー仕様

目的：生成前後で「縦書きになる安心感」を見せる（完全再現は狙わない）。

方式：

* 生成したHTML/XHTMLを縦書きCSS適用してiframe表示
* スマホは折りたたみ可能

---

## 9. API設計（Cloudflare Pages Functions）

### エンドポイント

* `POST /api/generate`

#### request（JSON）

* `url: string`
* `options:`

  * `tcyNumbers: boolean`
  * `tcyLatin: boolean`

#### response

* 成功：`application/epub+zip`（バイナリ）
* 失敗：`application/json`（`errorCode`, `message`, `hint`）

### 想定エラーコード

* `INVALID_URL`
* `NOT_PUBLIC`
* `FETCH_FAILED`
* `PARSE_FAILED`
* `EPUB_BUILD_FAILED`
* `SIZE_LIMIT`

### 悪用対策（将来）

* IPベースの簡易レート制限（Cloudflare側の仕組みを利用）

---

## 10. SEO設計（日本語検索流入の土台）

### ページ構成

* `/`：生成フォーム（メイン）
* `/howto`：使い方・FAQ（検索受け皿）
* `/privacy`：プライバシー
* `/terms`：利用規約
* `/about`：KazeX Records紹介＋Spotify

### FAQに入れるべき見出し（検索意図に寄せる）

* GoogleドキュメントからEPUBを作る方法
* Apple Booksで縦書きEPUBを読む方法
* ルビ付きEPUBを作る（｜漢字《かんじ》）
* スマホで縦書きEPUBを読む方法
* 目次が出ないとき（見出し設定）

### 技術SEO

* title/descriptionを日本語KW中心に設計
* 速度：静的配信＋軽量JS
* 将来：FAQPage構造化データ

---

## 11. 広告枠（Spotify埋め込み）

目的：KazeX Recordsの宣伝（再生・フォロー導線）。

仕様：

* 右カラムに固定的に見える位置（スクロールでも追従するかは後で検証）
* スマホでは下部に配置（生成体験を邪魔しない）

候補（将来AB）：

* KazeX公式プレイリスト
* 新譜ハイライト（固定1枚）
* 「作業BGMどうぞ」等の自然導線

---

## 12. 法務・プライバシー・安全（法務拡充）

### 必須ページ（MVPから設置）

* `/terms`：利用規約（日本語）
* `/privacy`：プライバシーポリシー（日本語）
* `/about`：運営主体（KazeX Records）と連絡先の簡潔な説明

### 利用規約（主な条項）

* ユーザーは**自ら権利を有するコンテンツのみ**を利用すること
* 違法・権利侵害コンテンツの変換は禁止
* 本サービスは「現状有姿」で提供され、変換結果の完全性を保証しない
* 不正利用（過剰リクエスト、スクレイピング、商用悪用等）は制限・停止の対象
* 生成物の権利は原則ユーザーに帰属
* サービス内容は予告なく変更・停止する場合がある

### プライバシー（原則）

* 生成はオンザフライ。本文を保存しない。
* ログは最小限（成功/失敗、エラーコード、処理時間、サイズ）
* URLの保存は原則しない（保存する場合は目的と期間を明示）
* 公開共有ドキュメントのみ対象であることを明記

### セキュリティ・運用

* Cloudflare側のレート制限を利用（将来）
* 不審アクセスの検知・遮断
* 障害時の告知方針（トップに簡易ステータス表示を検討）

---

## 13. リポジトリ・運用（GitHub Public + Cloudflare Pages）

* GitHub Public（MIT）
* PushでCloudflare Pages自動デプロイ（Preview Deploy有効化）
* mainブランチ運用

推奨ファイル：

* `LICENSE`（MIT）
* `README.md`（日本語中心＋英語1行）
* `CONTRIBUTING.md`
* `CODE_OF_CONDUCT.md`（任意だが推奨）
* `SECURITY.md`

---

## 14. 将来ロードマップ

優先順（提案）：

1. オプション追加（著者名、章分割ON/OFF）
2. Google Play Books検証・最適化
3. 非公開ドキュメント対応（OAuth）
4. 収益化拡張（広告ネットワーク、寄付、Pro）
5. M&A整備（指標ダッシュボード、runbook、運用手順）

---

## 15. M&Aを見据えた“最初からの仕込み”

* `/privacy` `/terms` をMVPから用意
* `/howto` を資産化（SEOの受け皿）
* 計測（最低限）

  * 生成成功/失敗
  * 主要導線のCTR（Spotify）
  * エラーコード別件数

買い手が見て安心する状態を、最初から積み上げる。

---

設計者：月野テンプレクス

---

